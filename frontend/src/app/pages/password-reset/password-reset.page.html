<section class="auth" aria-labelledby="reset-title">
  <div class="auth-card">
    <h2 id="reset-title">Alterar senha</h2>
    <p class="subtitle">Informe sua senha atual e defina uma nova com pelo menos 8 caracteres.</p>

    <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
      <!-- Senha atual -->
      <div class="field">
        <label for="current_password">Senha atual</label>
        <div class="input">
          <input id="current_password" [type]="showCurrent ? 'text' : 'password'" formControlName="current_password"
            autocomplete="current-password" required />
          <button type="button" class="toggle" (click)="toggle('current')">
            {{ showCurrent ? 'Ocultar' : 'Mostrar' }}
          </button>
        </div>
        <small class="hint error" *ngIf="touched('current_password') && form.get('current_password')?.invalid">
          Informe sua senha atual.
        </small>
      </div>

      <!-- Nova senha -->
      <div class="field">
        <label for="new_password">Nova senha</label>
        <div class="input">
          <input id="new_password" [type]="showNew ? 'text' : 'password'" formControlName="new_password"
            autocomplete="new-password" minlength="8" required />
          <button type="button" class="toggle" (click)="toggle('new')">
            {{ showNew ? 'Ocultar' : 'Mostrar' }}
          </button>
        </div>

        <div class="meter" aria-hidden="true">
          <span [class.filled]="strength() >= 1"></span>
          <span [class.filled]="strength() >= 2"></span>
          <span [class.filled]="strength() >= 3"></span>
          <span [class.filled]="strength() >= 4"></span>

        </div>
        <small class="hint" [ngClass]="{'error': touched('new_password') && form.get('new_password')?.invalid}">
          Força: {{ strengthLabel }}
        </small>
      </div>

      <!-- Confirmar nova senha -->
      <div class="field">
        <label for="new_password_confirm">Confirmar nova senha</label>
        <div class="input">
          <input id="new_password_confirm" [type]="showConfirm ? 'text' : 'password'"
            formControlName="new_password_confirm" autocomplete="new-password" required />
          <button type="button" class="toggle" (click)="toggle('confirm')">
            {{ showConfirm ? 'Ocultar' : 'Mostrar' }}
          </button>
        </div>
        <small class="hint error" *ngIf="mismatch">As senhas não conferem.</small>
      </div>

      <div class="actions">
        <button type="submit" class="primary" [disabled]="form.invalid || mismatch">Salvar nova senha</button>
        <a routerLink="/" class="link">Cancelar</a>
      </div>

      <div class="feedback error" *ngIf="error() as e">{{ e }}</div>
    </form>
  </div>
</section>