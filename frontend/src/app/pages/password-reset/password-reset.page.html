<section class="password-reset" aria-labelledby="password-reset-title">
  <header>
    <h2 id="password-reset-title">{{ pageTitle() }}</h2>
    <p *ngIf="mode() === 'change'">
      Mantenha sua conta protegida atualizando a senha regularmente. Informe a senha atual e defina uma nova combinação com pelo menos 8 caracteres.
    </p>
    <p *ngIf="mode() === 'request'">
      Esqueceu sua senha? Digite seu e-mail abaixo e enviaremos um link para redefinir sua senha.
    </p>
    <p *ngIf="mode() === 'confirm'">
      Digite sua nova senha abaixo para completar a redefinição.
    </p>
  </header>

  <!-- Formulário de alteração de senha (usuário logado) -->
  <form *ngIf="mode() === 'change'" [formGroup]="changeForm" (ngSubmit)="submitChange()" novalidate>
    <div class="form-group">
      <label for="current_password">Senha atual</label>
      <input
        id="current_password"
        type="password"
        autocomplete="current-password"
        formControlName="current_password"
        [class.invalid]="changeForm.controls.current_password.invalid && changeForm.controls.current_password.touched"
        required
      />
      <small *ngIf="changeForm.controls.current_password.invalid && changeForm.controls.current_password.touched">
        Informe a senha atual.
      </small>
    </div>

    <div class="form-group">
      <label for="new_password">Nova senha</label>
      <input
        id="new_password"
        type="password"
        autocomplete="new-password"
        formControlName="new_password"
        minlength="8"
        [class.invalid]="changeForm.controls.new_password.invalid && changeForm.controls.new_password.touched"
        required
      />
      <small *ngIf="changeForm.controls.new_password.invalid && changeForm.controls.new_password.touched">
        A nova senha deve ter no mínimo 8 caracteres.
      </small>
    </div>

    <div class="form-group">
      <label for="new_password_confirm">Confirmar nova senha</label>
      <input
        id="new_password_confirm"
        type="password"
        autocomplete="new-password"
        formControlName="new_password_confirm"
        [class.invalid]="changeForm.controls.new_password_confirm.invalid && changeForm.controls.new_password_confirm.touched"
        required
      />
      <small *ngIf="changeForm.controls.new_password_confirm.invalid && changeForm.controls.new_password_confirm.touched">
        Confirme a nova senha.
      </small>
    </div>

    <button type="submit" [disabled]="loading()">
      {{ loading() ? 'Salvando...' : 'Atualizar senha' }}
    </button>
  </form>

  <!-- Formulário de solicitação de reset -->
  <form *ngIf="mode() === 'request'" [formGroup]="requestForm" (ngSubmit)="submitRequest()" novalidate>
    <div class="form-group">
      <label for="email">E-mail</label>
      <input
        id="email"
        type="email"
        autocomplete="email"
        formControlName="email"
        [class.invalid]="requestForm.controls.email.invalid && requestForm.controls.email.touched"
        placeholder="seu@email.com"
        required
      />
      <small *ngIf="requestForm.controls.email.invalid && requestForm.controls.email.touched">
        Informe um e-mail válido.
      </small>
    </div>

    <button type="submit" [disabled]="loading()">
      {{ loading() ? 'Enviando...' : 'Enviar link de redefinição' }}
    </button>

    <div class="form-links">
      <a routerLink="/login">Voltar ao login</a>
    </div>
  </form>

  <!-- Formulário de confirmação de reset -->
  <form *ngIf="mode() === 'confirm'" [formGroup]="confirmForm" (ngSubmit)="submitConfirm()" novalidate>
    <div class="form-group">
      <label for="confirm_new_password">Nova senha</label>
      <input
        id="confirm_new_password"
        type="password"
        autocomplete="new-password"
        formControlName="new_password"
        minlength="8"
        [class.invalid]="confirmForm.controls.new_password.invalid && confirmForm.controls.new_password.touched"
        required
      />
      <small *ngIf="confirmForm.controls.new_password.invalid && confirmForm.controls.new_password.touched">
        A nova senha deve ter no mínimo 8 caracteres.
      </small>
    </div>

    <div class="form-group">
      <label for="confirm_new_password_confirm">Confirmar nova senha</label>
      <input
        id="confirm_new_password_confirm"
        type="password"
        autocomplete="new-password"
        formControlName="new_password_confirm"
        [class.invalid]="confirmForm.controls.new_password_confirm.invalid && confirmForm.controls.new_password_confirm.touched"
        required
      />
      <small *ngIf="confirmForm.controls.new_password_confirm.invalid && confirmForm.controls.new_password_confirm.touched">
        Confirme a nova senha.
      </small>
    </div>

    <button type="submit" [disabled]="loading()">
      {{ loading() ? 'Salvando...' : 'Redefinir senha' }}
    </button>

    <div class="form-links">
      <a routerLink="/login">Voltar ao login</a>
    </div>
  </form>
</section>
